### Objetivo:

![[Pasted image 20240505130030.png]]

### Leer:

![[Pasted image 20240505113051.png]]
![[Pasted image 20240505113113.png]]

### Pasos:

Paso #1:
Creamos un exploit.

![[Pasted image 20240505113801.png]]

Paso #2:

Intentamos cargar nuestro exploit.php y como vemos me da un error.

![[Pasted image 20240505113930.png]]

![[Pasted image 20240505113950.png]]

Como vemos nos dice que solamente permite archivos JPG y PNG... Entonces probaremos subir siempre nuestro archivo ***exploit.php*** pero SOLAMENTE cambiaremos la extension para validar si la validacion se está haciendo mediante la extensión del archivo, el Content Type o los Magic Numbers (Codigo inicial hexadecimal).

Y como vemos solo con cambiar la extension del archivo se logra subir, con eso intuimos que la validacion se hace por la extension del archivo, pero si apuntamos a él igual NO se interpretara con php si no como una imagen.

![[Pasted image 20240505114430.png]]

Ahora intentaremos hacer un byPass para que el servidor piense que es un archivo ***.png*** le pasaremos el nombre ***exploit.php.png*** a ver que pasa... Como vemos si me dejo subirlo ahora intentaremos cargarlo... 

![[Pasted image 20240505114856.png]]


Vemos que lo carga igualmente como una imagen.

![[Pasted image 20240505114942.png]]

Se pone mas complejo, vemos que me está tomando el ***.png*** al guardar el archivo en el servidor. Entonces aplicaremos otra tecnica de byPass utilizando el ***%00*** para agregar el ***.png*** al final y LOGRE PASAR la validacion de la extension, PEROO al GUARDAR el archivo que esto evite guardarlo con el ***.png*** que es lo que ira luego del ***%00*** y quedaria de esta manera:   ***exploit.php%00.png***  y dentro del server se guardaria asi ***exploit.php***

![[Pasted image 20240505115428.png]]

Y como vemos se logro guardar como ***exploit.php*** y solo toca apuntar a él y ejecutarlo...



![[Pasted image 20240505115527.png]]

Vemos que al apuntar a él lo tira de esta manera: ***exploit.php%00.png*** entonces solo borramos el ***%00.png*** a ver que pasa... Vemos que ya pudimos extraer la flag.

![[Pasted image 20240505115613.png]]


Ahora veremos con una shell el codigo del archivo encargado de subir las fotos a ver donde esta el error.

![[Pasted image 20240505115838.png]]

Como vemos el error esta en esas lineas que enmarque, lo que pasa es que el dev valida si NO viene como ***.jpg o .png*** y solo con ponerle .png o .jpg ya hacemos el byPass, y la otra cagada es que luego hace un corte a travez de null bytes ***%00*** y entonces todo lo que sigue luego del %00 se corta y NO se toma en cuenta. Por lo tanto si mandamos ***exploit.php%00. png*** es una combinacion perfecta, por que con el .png bypasseamos la primera validacion y con el %00 lo cortamos para que quede como ***exploit.php*** y se guarde de esa manera.

![[Pasted image 20240505120328.png]]
