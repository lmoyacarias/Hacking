### Objetivo:

![[Pasted image 20240504134306.png]]

### Pasos:

Paso #1:
Creamos en exploit en este caso es uno en .php y luego le cargare en el servidor.

![[Pasted image 20240504134407.png]]

Paso #2:
Cargamos el exploit y lo subimos. Como vemos da un error de que no permite subir archivos php.

![[Pasted image 20240504134529.png]]
![[Pasted image 20240504134549.png]]

Intentaremos cambiar la extensión del archivo a ver que pasa. Y vemos que se subió correctamente (ya podemos intuir que la validación se hace verificante la extensión del archivo) ahora toca apuntar a el y ejecutarlo.
 
![[Pasted image 20240504134728.png]]

Notamos que al ejecutarlo no nos interpreta el código php:

![[Pasted image 20240504134823.png]]

Entonces probaremos con diferentes formas para hacerle un Path Traversal:

![[Pasted image 20240504134949.png]]
![[Pasted image 20240504135010.png]]
![[Pasted image 20240504135041.png]]
Como pudimos ver el archivo si se sube, pero NO hace el path traversal a ***/files***

Ahora regresamos a este punto

![[Pasted image 20240504135206.png]]

![[Pasted image 20240504135223.png]]

Una vez visto eso, intentaremos hacer una anulación en la parte del servidor y le daremos una instrucción al archivo ***.htaccess*** para que nos interprete los archivos ***.moya*** (inventados por mi) como si fueran código de archivos ***.php***

Paso #3:
Creamos el archivo ***.htaccess*** para hacer la anulacion en esa carpeta de ***/files/avatars***

![[Pasted image 20240504135603.png]]

Una vez creado, subiremos este archivo al servidor a ver si nos deja. Y como podemos ver si me dejo subirlo. Ahora en teoría lo que pasara en la ruta ***/files/avatars/*** es que todos los archivos ***.moya*** que se encuentren en esa ruta serán interpretados como código ejecutable ***php***

![[Pasted image 20240504135752.png]]
![[Pasted image 20240504135812.png]]


Paso 4:
Ahora en lugar de subir ***exploit.php*** subiremos un ***exploit.moya*** y apuntaremos a él a ver que pasa. Y como vemos me dejo subirlo.

![[Pasted image 20240504140108.png]]
![[Pasted image 20240504140121.png]]

Paso 5:
Apuntar al archivo ***exploit.moya***, ejecutarlo y obtener la flag.

![[Pasted image 20240504140215.png]]


Ahora veremos el porque se produjo este fallo en el servidor, para eso subiremos nuestra ***shell.moya***

![[Pasted image 20240504141212.png]]

Y como vemos solo esta validando si vienen archivos ***.php*** o ***.phtml*** para rechazar la solicitud.

![[Pasted image 20240504141548.png]]

Ahora tambien veremos si ya existia o no un archivo ***.htaccess*** en es ruta del servidor donde se alojo nuestro archivo. Y como vemos NO exisita, entonces al crear ese dentro de esa ruta se anularon las configuraciones globales del servidor y se tomaron las de ese ***.htaccess*** solo para esa misma ruta ***/files/avatars/***

![[Pasted image 20240504141907.png]]

### Conclusión:

Como pude notar existia una validacion en el tipo de archivos que se subia, en este caso NO dejaba subir archivos .php ni tampoco hacer un path traversal, entonces como vimos pudimos subir un archivo .php5, pero de igual manera podiamos subir .exe, .hola etc, mientras NO sean archivos .php, pero de igual manera aunque subieramos archivos de otro tipo de nada servia porque NO lo ibamos a poder ejecutar, simplemente solo podriamos visualizar el codigo fuente de dicho archivo subido.

Basicamente era un servidor vulnerable a la subida de archivos, pero no tanto a la carga de estos archivos (ya que no los interpretaba), entonces lo que hicimos fue explotar un ***ANULACION DE CONFIGURACION DEL SERVIDOR*** para poder interpretar estos archivos cargados. Inyectamos un ***.htaccess*** que basicamente el server lo interpreta como una configuracion de Apache y le metimos una intruccion que nos interpreta los archivos ***.moya*** como si fueran archivos ***.php***



