#### **Objetivo:**

![[Pasted image 20240503211851.png]]

Pasos:

Paso #1:
Creamos un exploit y tambien creare un shell nada mas para luego ver EL PORQUE se produjo el fallo por detras de la carga de ese archivo (para aprender donde esta ese error de código).

![[Pasted image 20240503212209.png]]

Paso #2:
Intentamos subir nuestro exploit.php normalmente.

![[Pasted image 20240503213435.png]]

Vemos que nos da un error al subir nuestro archivo exploit.php

![[Pasted image 20240503213603.png]]

Como pudimos ver al parecer nos dice "Sorry, file type **application/x-php** is nor allowred Only **image/jpeg and image/png** are allowed..."

Y esto sucede porque en los Request Headers al enviarse como multipart/form-data al segmentar la informacion con sus respectivos Content-Disposition y buscamos la parte en donde se envia la informacion el archivo "exploit.php" que enviamos, podremos observar que en su "Content-Type" dice "**application/x-php"**. Jumm curioso que tiene el mismo nombre del mensaje de error **application/x-php** como que no permite ese tipo de archivo solo image/jpeg y image/png, entonces al ver eso podemos intuir que la validacion de dicho archivo desde el lado del servidor se está haciendo por su "Content-Type" que llega del Request.

Ahora para tener una mejor vision veamos la request a travez de Burp Suite.
![[Pasted image 20240503214452.png]]

Como podemos ver se está enviando en el Content-Type un **application/x-php**, probemos enviarle algo como **image/jpeg o image/png** para que el servidor piense que es una imagen (ya que como pudimos intuir antes el servidor se esta fiando de lo que diga el Content Type), veremos que sucede...
![[Pasted image 20240503214700.png]]

Efectivamente, ahora si pudimos subir nuestro exploit.php y ahora toca apuntar a él para ejecutarlo. Y como vemos ya obtuvimos la flag.

![[Pasted image 20240503214837.png]]


Ahora para confirmar nuestra intucion al 100% (aunque igual ya explotamos el fallo y pudimos notar que el server confiaba en el Content Type de la request) subiremos una shell para poder ver el codigo fuente del archivo que se encarga de manejar la subida de archivo...

Y al ver el codigo fuente del archivo upload.php (suponiendo que es el encargado de la logica de la subida de archivos) vemos que hay un pequeño error.

![[Pasted image 20240503215547.png]]


Acá podemos ver que el developer hace una validacion que si en el Content Type NO se encuentra en la lista de allowedTypes (image/jpeg o image/png) de un error, y claro esto es facil de burlar ya que solamente teniamos que cambiar el Content Type a la lista de archivos permitidos.

![[Pasted image 20240503220009.png]]

### Conclusión:

Como pude notar este servidor era vulnerable a este tipo de ataque pero la persona que lo desarrollo al parecer SI hizo una validación para evitar subida de archivos que no sean JPEG , lastimosamente lo hizo fiandose del Content Type que se envia en el Request, y yo como atacante pude falsificar dicho Content Type para hacer un ByPass de esta validación y lograr con exito el ataque.


